<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flyers Listening Part 4 - Sam's Trip to the Beach</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
            color: #1f2937;
            padding: 1rem;
        }
        .section-box {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .answer-key-container {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: all 0.5s ease-in-out;
            padding: 0 1rem;
            margin-top: 0;
        }
        .answer-key-container.visible {
            max-height: 2000px; 
            opacity: 1;
            padding: 1rem;
            margin-top: 1.5rem;
        }
        .correct-answer {
            color: #10b981; /* Emerald 500 */
            font-weight: 600;
        }
        .question-group {
            border-left: 4px solid #4f46e5; /* Indigo */
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body class="min-h-screen flex items-start justify-center">

    <div id="app" class="w-full max-w-4xl mt-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2 text-center">Flyers Listening Part 4 - Practice (A2 Level)</h1>
        <p class="text-gray-500 mb-6 text-center">Section 4: The Story - Sam's Trip to the Beach</p>

        <div class="section-box">
            <h2 class="text-xl font-semibold text-indigo-600 mb-4">Hướng dẫn:</h2>
            <p class="mb-4">Bạn sẽ nghe một câu chuyện về chuyến đi biển của Sam. Hoàn thành các câu dưới đây. </p>
            <p class="font-bold mb-6">Viết **MỘT TỪ HOẶC MỘT SỐ** cho mỗi câu trả lời.</p>

            <!-- Audio Player (SoundCloud Embed) -->
            <div class="mb-6 border-b pb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Trình phát Audio</h3>
                <div class="rounded-lg overflow-hidden shadow-md">
                    <iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" 
                            src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/soundcloud%253Atracks%253A2183200315&color=%2300cc11&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true">
                    </iframe>
                </div>
                <!-- Note: The download button links to the SoundCloud page -->
                <button id="downloadButton" 
                        class="mt-4 w-full px-6 py-3 bg-yellow-600 text-white font-semibold rounded-xl shadow-lg hover:bg-yellow-700 transition duration-150">
                    Tải Audio về máy (SoundCloud)
                </button>
            </div>

            <!-- Check Answers Button -->
            <button id="checkAnswersButton" 
                    class="w-full px-6 py-3 bg-red-600 text-white font-semibold rounded-xl shadow-lg hover:bg-red-700 transition duration-150">
                Kiểm tra đáp án
            </button>
            <div id="messageBox" class="mt-4 p-3 text-sm rounded-lg text-yellow-800 bg-yellow-100 hidden"></div>

            <!-- Questions Form (Note Completion) -->
            <form id="listeningForm" class="mt-8 space-y-6">
                
                <div class="question-group">
                    <h3 class="text-lg font-bold text-gray-700 mb-3">Questions 1-5: Complete the sentences.</h3>
                    
                    <p class="ml-4 mt-2">1. Sam had some toast and a glass of <input type="text" id="q1" class="border p-1 rounded-md w-1/3" placeholder="Answer 1"> for breakfast.</p>
                    <p class="ml-4 mt-2">2. The family went to the beach in their small, <input type="text" id="q2" class="border p-1 rounded-md w-1/3" placeholder="Answer 2"> car.</p>
                    <p class="ml-4 mt-2">3. The car journey took about <input type="text" id="q3" class="border p-1 rounded-md w-1/3" placeholder="Answer 3"> minutes.</p>
                    <p class="ml-4 mt-2">4. Sam was looking for small <input type="text" id="q4" class="border p-1 rounded-md w-1/3" placeholder="Answer 4"> near the rocks.</p>
                    <p class="ml-4 mt-2">5. Sam put two small, <input type="text" id="q5" class="border p-1 rounded-md w-1/3" placeholder="Answer 5"> shells on top of the sandcastle.</p>
                </div>
                
                <!-- Check Answers Button (bottom) -->
                <button id="checkAnswersButtonBottom" 
                        class="w-full px-6 py-3 bg-red-600 text-white font-semibold rounded-xl shadow-lg hover:bg-red-700 transition duration-150">
                    Kiểm tra đáp án
                </button>
            </form>

            <!-- Answer Key and Script Container (Initially hidden) -->
            <button id="toggleAnswersButton" 
                    class="mt-6 px-4 py-2 text-sm font-medium text-green-700 bg-green-100 rounded-lg hover:bg-green-200 transition duration-150">
                Show Script & Answers
            </button>
            <div id="answerKeyContainer" class="answer-key-container">
                <div class="section-box bg-white p-6 mt-4">
                    <h3 class="text-xl font-semibold mb-3 text-gray-800 border-b pb-2">Answer Key (Đáp án)</h3>
                    <div id="answersList" class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 text-sm">
                        <!-- Answers will be injected here -->
                    </div>
                </div>

                <div class="section-box bg-white p-6 mt-4">
                    <h3 class="text-xl font-semibold mb-3 text-gray-800 border-b pb-2">Full Script (Bản ghi đầy đủ)</h3>
                    <div id="scriptDisplay" class="max-h-96 overflow-y-auto text-sm text-gray-700 leading-relaxed">
                        <!-- Script will be injected here -->
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <script type="module">
        // --- Flyers Script and Answers (Based on the provided monologue) ---
        const scriptData = {
            dialogue: [
                { text: "This is a story about a boy named Sam and his family trip." },
                { text: "Last Saturday, Sam woke up early. It was a sunny day, and he was very excited. His mother said, \"Today, we are going to the beach!\" Sam quickly ate his breakfast—some toast and a glass of **milk**." }, // Q1
                { text: "At nine o’clock, the family got into their small, **red** car. Sam brought his favourite yellow ball and a large, blue towel. The drive to the beach was about **thirty** minutes." }, // Q2, Q3
                { text: "When they arrived, the beach was full of people. Sam ran straight to the water. His dad shouted, \"Don't go too far, Sam!\" Sam played with his ball near the rocks. He looked for small **crabs** in the wet sand." }, // Q4
                { text: "For lunch, they ate sandwiches with cheese and tomatoes. After lunch, Sam helped his mother build a big sandcastle. It had a tall tower and a deep wall. Sam put two small, **pink** shells on the top of the castle." }, // Q5
                { text: "When it was time to go home, Sam was very tired but happy. He slept all the way in the car. It was the best day trip he had all summer. Now, he wants to go back again next weekend." }
            ],
            answers: {
                q1: "milk",
                q2: "red",
                q3: "thirty",
                q4: "crabs",
                q5: "pink"
            }
        };

        // --- DOM Elements ---
        const checkAnswersButton = document.getElementById('checkAnswersButton');
        const checkAnswersButtonBottom = document.getElementById('checkAnswersButtonBottom');
        const toggleAnswersButton = document.getElementById('toggleAnswersButton');
        const answerKeyContainer = document.getElementById('answerKeyContainer');
        const answersList = document.getElementById('answersList');
        const scriptDisplay = document.getElementById('scriptDisplay');
        const messageBox = document.getElementById('messageBox');
        const downloadButton = document.getElementById('downloadButton');

        // --- Logic Functions ---

        const showMessage = (text, type = 'warning') => {
            messageBox.textContent = text;
            messageBox.className = `mt-4 p-3 text-sm rounded-lg ${type === 'error' ? 'text-red-800 bg-red-100' : type === 'success' ? 'text-green-800 bg-green-100' : 'text-yellow-800 bg-yellow-100'}`;
            messageBox.style.display = 'block';
        };

        const renderScriptAndAnswers = () => {
            // Render Answers
            answersList.innerHTML = Object.keys(scriptData.answers).map((key, index) => {
                let displayIndex = index + 1; // Start counting from 1
                return `<p><strong>${displayIndex}.</strong> <span class="correct-answer">${scriptData.answers[key].toUpperCase()}</span></p>`;
            }).join('');

            // Render Script
            scriptDisplay.innerHTML = scriptData.dialogue.map(line => `
                <p class="mb-3">${line.text}</p>
            `).join('');
        };

        const toggleAnswers = () => {
            const isVisible = answerKeyContainer.classList.toggle('visible');
            toggleAnswersButton.textContent = isVisible ? 'Hide Script & Answers' : 'Show Script & Answers';
        };

        const checkAnswers = () => {
            let correctCount = 0;
            const totalQuestions = 5;
            
            for (let i = 1; i <= 5; i++) {
                const qId = `q${i}`;
                const inputElement = document.getElementById(qId);
                // Clean user input: trim whitespace, convert to lowercase
                const userAnswer = inputElement.value.trim().toLowerCase();
                // Get correct answer and convert to lowercase for comparison
                const correctAnswer = scriptData.answers[qId].trim().toLowerCase();
                
                let isCorrect = userAnswer === correctAnswer;
                
                // Allow number as text (e.g., '30' vs 'thirty') - simple check
                if (!isCorrect && (userAnswer === '30' && correctAnswer === 'thirty')) {
                    isCorrect = true;
                }
                
                if (isCorrect) {
                    correctCount++;
                    inputElement.style.borderColor = '#10b981'; // green
                } else {
                    inputElement.style.borderColor = '#ef4444'; // red
                }
            }

            showMessage(`Bạn đã trả lời đúng ${correctCount}/${totalQuestions} câu. Nhấn 'Show Script & Answers' để xem chi tiết.`, correctCount === totalQuestions ? 'success' : 'warning');
        };
        
        const downloadAudioFile = () => {
            // Links to the SoundCloud page
            const soundcloudUrl = 'https://soundcloud.com/truong-le-252173324/sam';
            window.open(soundcloudUrl, '_blank');
            showMessage("Audio này được nhúng từ SoundCloud. Vui lòng kiểm tra trên trang SoundCloud để xem tùy chọn tải về.", 'warning');
        };

        // --- Initialization and Event Listeners ---
        window.onload = () => {
            renderScriptAndAnswers();
        };

        const checkHandler = (e) => {
            e.preventDefault();
            checkAnswers();
        };
        checkAnswersButton.addEventListener('click', checkHandler);
        checkAnswersButtonBottom.addEventListener('click', checkHandler);
        
        toggleAnswersButton.addEventListener('click', toggleAnswers);
        downloadButton.addEventListener('click', downloadAudioFile);
    </script>
</body>
</html>